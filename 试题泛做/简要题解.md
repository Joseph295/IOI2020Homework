##### AGC020D Min Max Repetition

最终串一点是前半部分 $k$ 个 `A` 一个 `B` 循环，后半部分一个 `A` $k$ 个 `B` 循环，二分求出这个分界线。

##### AGC020E Encoding Subsets

记 $f(S)$ 表示状态 $S$ 的答案，直接记搜。可证状态数很少，是 $O(N^3+2^{N/8})$ 的，因此能过。

##### AGC020F Arcs on a Circle

考虑每个线段放置的位置的小数部分，只有小数部分的相对顺序会影响答案，因此如果把每个长度为 $1$ 的线段拆成 $n$ 份来表示相对位置，每种位置只会被占一次。同时状压每种线段和每种位置即可。

##### AGC021E Ball Eat Chameleons

枚举 $R$ 和 $B$，首先 $R<B$ 无解，$R\ge B$ 时还需满足能从序列中找出 $N-(R-B)$ 个子序列 `RB`。如果画到平面上，就相当于不经过斜线 $y-x\ge R-N+1$ 的路径计数，这是卡特兰数经典题。需要注意特判 $R=B$ 时必须以 `B` 结尾。

##### AGC021F Trinity

先不考虑空行，假设 $f(i,j)$ 表示行都非空的 $i$ 行 $j$ 列方案数，那么总答案是 $\sum \binom{n}{i} f(i,m)$。

考虑按列 dp，新增一列时枚举有 $k$ 行被新增了，即 $f(i,j) \to f(i+k,j+1)$，当 $k=0$ 时系数显然是 $\binom{i}{0}+\binom{i}{1}+\binom{i}{2}$，否则列最值一定在新增行的上下方。可以把列最值也看成空行，那么系数就是 $\binom{i+k+2}{k+2}$。转移形式是卷积，FFT 优化即可。

##### AGC022D Shopping

首先所有 $t \bmod 2L$，考虑朴素做法，就是从左到右每到一个点就额外花 $2L$ 的时间让车跑一圈。考虑两个点 $A<B$ 满足 $A$ 左边的路程 $\ge t_A$，$B$ 右边的路程 $\ge t_B$，那么先处理 $B$ 再处理 $A$ 就可以减少 $2L$ 的时间。因此求出最多的这种配对数即可。注意特判最后一个点是否需要跑一圈。

##### AGC022E Median Replace

在最后放一个 $1$，然后设序列 $a$ 是每两个 $1$ 之间的 $0$ 个数。可以发现操作在 $a$ 上相当于一个 $>2$ 的数 $-2$，或者将相邻两个 $x,y$ 合并成 $x+y-1$，或者将相邻两个 $0$ 消掉。因此奇数可以不管，剩下的偶数要找出两个 $0$ 使得前后的数的个数都是偶数个。于是就可以 dp 了。

##### AGC022F Checkers

$X$ 很大，不管它，把数都看成 $n$ 维向量。其次，向量里的顺序不影响，这里考虑向量里的数构成的多重集。即一开始所有都是 $\{1\}$，每次操作选 $A$ 和 $B$，合并为 $2A\cup -B$。

观察发现，合法集合里有 $\pm 2^k$ 就有 $\pm 2^{k-1}$，且总和一定为 $1$。此外，还有一个条件，即对于每个 $i$ 可以调整 $\pm 2^i$ 的符号来使得 $\le i$ 次项和为 $1$。证明必要性显然，考虑用归纳法证充分性，即合法集合 $S$ 定能拆成合法集合 $2A$ 和 $-B$。显然 $A$ 和 $B$ 其中一个符合这个条件时另一个一定符合。

不妨设 $-1\in S$，记 $S$ 的最小正值为 $+2^k$，假如更小的负次项都至少出现两次，那么构造 $A=\{-1,-2,\ldots,-2^{k-2},+2^{k-1}\}$ 合法。假如 $-2^1$ 只出现一次，取 $B=\{1\}$ 合法。否则 $S$ 本身就不合法。

最后考虑怎么 dp，设 $f(i,j)$ 表示 $i$ 个数，当前和是 $1+j\times 2^m$ 的形式的答案，其中 $2^m$ 是当前最高次项。dp 下一次项时并不需要知道 $m$ 具体是多少，只用枚举下一次项的正负个数即可。

##### AGC023D Go Home

考虑两端点的人数分别是 $A,B$，当 $A\ge B$ 因为 $B$ 打不过 $A$ 所以不能在 $A$ 之前到家，所以 $B$ 在 $A$ 到家之前会希望 $A$ 赶紧到家，因此可以看作 $A$ 处理。$A<B$ 同理。递归直到 $S$ 只有一侧有人即可。

##### AGC023E Inversions

考虑 $A_i\le A_j$ 位置处的贡献，显然是把 $A_j$ 修改为 $A_i$ 后的可能排列数除 $2$。考虑如何统计排列数，设 $c_i$ 是 $\ge i$ 的 $A$ 的个数减 $(N-i)$，那么答案是 $\prod c_i$。如果把 $A_j$ 改为 $A_i$ 相当于 $A_i+1\sim A_j$ 这段的 $c$ 减 $1$。设 $d$ 是 $\frac{c_i-1}{c_i}$ 的前缀积，那么新答案就是原答案乘 $\frac{d[A_j]}{d[A_i]}$。问题变为求 $j$ 前面小于 $A_j$ 的 $\frac{1}{d[A_i]}$ 的和，可以 BIT。注意 $d$ 是 $0$ 的情况，记一下 $0$ 个数就行。

对于 $A_i>A_j$ 的位置类似的求正序对然后用总的减就行了。

##### AGC023F 01 on Tree

给每个节点设置一个权值 $R_i$ 是节点上 $0$ 的个数除以 $1$ 的个数，每次把 $R$ 最大的点往尽可能前放一定不劣，因此当前树上 $R$ 最大的点一定在其父节点之后，将其与父节点合并然后继续下一轮。

##### AGC024D Isomorphism Freak

显然颜色数是 $\lfloor\frac{D+1}{2}\rfloor$。固定直径的中心以后叶子数显然是每个深度的最多儿子数之积。直径为奇数个点时要额外考虑中心和一个相邻点共同作为中心的情况。

##### AGC024E Sequence Growing Hard

考虑插入一个数 $A$ 的时候它后面的数 $B$，如果 $A<B$ 就挂了，$A=B$ 可以看作是在 $B$ 后面插入，$A>B$ 就合法。因此每个数插入的时候向后面连边就形成一个森林，满足儿子比父亲权值和标号都大。树形 DP 即可。

##### AGC024F Simple Subsequence Problem

考虑直接 dp 出每种串的出现次数。一个一个字符匹配，设 $f(A|B)$ 表示串是 $A+\mathrm{subseq}(B)$ 的形式的答案，考虑向后转移一个字符，要么取 $B$ 中第一位，要么取另一种字符在 $B$ 中第一次出现。

##### AGC025D Choosing Points

显然格点上不存在长为奇数的环使得边长都是 $\sqrt{D}$，因此每个限制是个二分图，每次都取较大的一半就行了。

##### AGC025E Walking on a Tree

答案可以取到上界，考虑递归构造，删除一个叶子的时候，如果有两条路径都到这个叶子，合并这两条就行了。

##### AGC025F Addition and Andition

观察发现 $\&$ 起来的 $1$ 会逐渐往高位移，但显然不会追上前一个 $1$。因此从高到低考虑 $k$ 次之后的答案，如果当前是 $11$ 就往前走，遇到 $10,01$ 就暴力，遇到 $00$ 可以一段跳过，因为低位不影响高位所以遇不到下一个 $11$。

考虑复杂度，当前进位是 $11$ 的时候总的 $1$ 个数必然减少 $1$，并且变为 $10,01$，而进位是 $10,01$ 的时候要么 $1$ 的个数减少 $1$，要么变成 $11$，因此每两步总的 $1$ 个数至少减少 $1$，均摊就是 $O(N)$ 的。

##### AGC026D Histogram Coloring

考虑由上一行推到下一行，显然可以直接反色。如果上一行交替排列，这一行也可以和上一行相同。因此在笛卡尔树上 dp 就行了。

##### AGC026E Synchronized Subsequence

考虑一个 `ab` 个数相同的极短段，如果 `a` 在前，那么可以最大从中选出形如 `abab...ab` 的串。如果 `b` 在前，那么最大一定是从中选出一组后缀，因为选了第 $i$ 个 `b` 再选第 $i+1$ 个 `b` 一定更优。显然每段要么不选要么选最大，直接 dp 即可。

##### AGC026F Manju Game

黑白染色，假设第一个是黑色。如果 $n$ 是偶数显然答案分别是 $\max(B,W)$ 和 $\min(B,W)$。

如果 $n$ 是奇数，考虑先手怎么操作，可以选一个白的，然后后手选一边拿完，变成一个子问题；先手也可以选边上的黑色直接结束游戏。也就是说先手保底有 $W$ 收益，可能会在某一次子问题的时候选黑以额外增加收益。

对于一种用白色把序列划分的方法，显然后手可以递归到 $B'-W'$ 最小的一段去，因此先手的收益就是 $W+B'-W'$。因此问题变成找一种划分使得每段 $B'-W’$ 的最小值最大。可以二分答案然后贪心判断。

##### AGC027D Modulo Matrix

黑白染色，设黑格子是周围白格子的 $lcm+1$，只需要保证互不相同。按斜行分配奇质数即可。

##### AGC027E ABBreviate

设 `a` 为 $1$，`b` 为 $2$，那么 $S$ 可以变成字符 $c$ 当且仅当 $S=c$，或者 $\mathrm{Sum}(S) \mod3 =c$ 且 $S$ 有至少两个相邻字符相同。考虑 $S$ 变成 $T$ 的过程相当于对 $S$ 做一个划分，因此 dp 即可。

##### AGC027F Grafting

考虑如果有一个点没动过，那么可以求出哪些点不需要也不应该动。对于要动的点，$A$ 中满足儿子比父亲先动，$B$ 中满足父亲比儿子先动，这个关系不成环就行了。

但是有所有点都动的情况，如 1-2-3-4-5 变成 3-1-2-4-5，因此可以枚举第一步怎么动，第一步之后这个点就不会再动了。

##### AGC028C Min Cost Cycle

考虑总的减去被删的，假设被删的状态是 $00,01,10,11$，显然 $00$ 和 $11$ 个数相同，假设 $z$ 个。现需要找出一个顺序使得相接的地方的恰有 $1$ 个 $1$。显然 $z=0$ 的时候不能同时有 $01$ 和 $10$，这个特判。有 $00$ 的时候能构造出来：把 $z$ 个 $11$ 和 $z-1$ 个 $00$ 串一起，然后左边全放 $10$，右边 $01$，最后用个 $00$ 串起来。因此贪心即可。

##### AGC028D Chords

设 $f(l,r)$ 表示存在 $l$ 到 $r$ 这个连通块的方案数，直接容斥用总的减去可能存在一个 $f(l,k)$ 的方案数即可。

##### AGC028E High Elements

一个一个加，考虑判断当前状态是否可行。假设两个数列最大值分别是 $max_0, max_1$，好点个数是 $cnt_0,cnt_1$。

如果说原序列的好点叫真好点，显然我们可以让某个序列新增的好点只有真好点，因为如果都有假好点，交换这一对就行了。这样假设 $a$ 新增好点的只有真好点，如果 $b$ 新增了 $k$ 个真好点，$m$ 个假好点，而剩余的真好点有 $q$ 个，有 $cnt_0+q-k=cnt_1+k+m$，移项发现是要求 $2k+m$ 是定值，即后缀找出一个上升子序列，其中好点贡献是 $2$，非好点贡献是 $1$，要求贡献恰好为 $c$。显然 $c$ 能凑那么 $c-2$ 肯定能凑，因此分奇偶记后缀的最大权上升子序列就行了，BIT。

##### AGC028F Reachable Cells

大致思路是分治，考虑上面走到下面的方案数，枚举上面的格子，看它能走到分界面的哪些位置，想办法维护这些位置能到的下面的格子的并。

细节过多，详细题解移步[王修涵博客](https://blog.csdn.net/wxh010910/article/details/83065702#t5)。

##### AGC029C Lexicographic constraints

二分答案，维护串，变长就加 $0$，没变长就对应位加 $1$，拿个栈模拟就行了。

##### AGC029E Wandering TKHS

考虑一个点比父节点多走多少，假设 $1$ 到父节点和 $1$ 到父节点的父节点最大值分别是 $max$ 和 $max'$，那多走的大概是个 $Reach(u,max)+1$ 或者 $Reach(u,max)-Reach(u,max')$ 的形式。算一下可以发现一个点只会在他到 $1$ 的链上最大值处被 $Reach$ 算到，因此 $Reach$ 直接暴力实现复杂度就均摊了。

##### AGC029F Construction of a tree

假设 $1$ 是根，先网络流从每个集合里选一个数形成一个 $2\sim n$ 的排列，把它们看作每个集合那条边的子节点。接下来从 $\{1\}$ 开始贪心能找到父节点就接上去。显然能构造出来一定是对的，考虑中途一步不能构造出来的时候，说明无论如何与已经确定的 $k$ 个点相关的边数都达不到 $k$ 条，显然这在树中是不可能的，因此是无解的。

##### AGC030C Coloring Torus

考虑朴素染色，对 $(i,j)$ 染 $(i+j)\bmod n$。当 $n$ 是偶数的时候，每个 $t$ 恰与一个奇行 $t\pm 1$ 和一个偶行 $t \pm 1$ 相邻，那么把奇偶行的 $t$ 替换成两个不同的颜色 $t_1,t_2$ 是不影响合法性的。因此对一个偶数 $n$，能构造出 $k\in [n,2n]$ 的答案。

##### AGC030D Inversion Sum

$f(i,j)$ 表示 $a_i>a_j$ 的概率，dp 即可。

##### AGC030E Less than 3

先差分，变为 $1$ 移动，因为限制显然不会出现两个 $1$ 在中间抵消或出现的情况，但可以在开头抵消或是移到末尾处理掉。而且显然任意一种局面都有方案移动到另一种局面，因此枚举两个串的 $1$ 怎么对应就行了。

##### AGC030F Permutation and Minimum

把有值的数对 $(x,y)$ 全删掉，再把 $(-1,-1)$ 看作无序的，最后乘阶乘。考虑从大往小填，有两类数，A 类是出现过的，B 类是没出现过的，显然不能出现 $(A,A')$ 这样的数对，因此考虑 dp，设 $f(x,i,j)$ 表示当前填到 $x$，$(B,-1)$ 有 $i$ 对，$(A,-1)$ 有 $j$ 对的方案数即可。注意 $B$ 填入 $(A,-1)$ 的时候因为 $A$ 有序所以要乘 $j$。

##### AGC031D A Sequence of Permutations

用 $(A,B)$ 表示置换的叠加 $ABA^{-1}$，找规律发现 $(T,A)$ 和 $(T,B)$ 在 $6$ 次之后会变成 $(TB^{-1}ABA^{-1},A)$ 和相应的 $B$，因此只需要求 $(B^{-1}ABA^{-1})^{\frac{k}{6}}$ 即可。

##### AGC031E Snuke the Phantom Thief

枚举一共恰好选了 $K$ 个，限制形如 $\le x$ 的至多 $i$ 个，就能转成排序后从第 $i +1$ 个开始坐标必须 $>x$。两维各有限制，费用流做类似匹配即可。

##### AGC031F Walk on Graph

倒过来，问题变为 $x\to 2x+c$。因为模数是奇数，$x \leftrightarrow 2x+c$。因为当有两条边 $a,b$ 相邻时，同一点上 $x=4x+3a=4x+3b$，因此模数可以变成 $\gcd(MOD,3(a-b))$，假设是 $3g$。

假设边模 $g$ 都是 $z$，显然问题 $+z$ 而边 $-z$ 是不影响答案的。因此可以让边都是 $g$ 倍数。

假设固定状态 $[1,x]$，那么其余状态是 $[u,2^{p}x+qg]$ 的形式，$q<3$。因为 $x=4x+3c$，而 $3c$ 含 $3g$ 因此模掉了，所以 $x$ 和 $4x$ 也等价，所以 $p<2$。所以状态 $6n$ 个，并查集连一连，最后询问看看能否找到 $p,q$ 是 $4$ 的次幂即可。

##### AGC032C Three Circuits

首先图是个欧拉图，有度数 $\ge 6$ 的点有解，有三个度数 $=4$ 的点有解，有两个度数 $=4$ 的点时，只有这两个点各有一自环才有解。

##### AGC032D Rotation Sort

操作相当于把数扔到往左往右任意一个位置，因此选出不动的数以后剩下的数的方向是固定的，从小到大 dp 不动的数即可。

##### AGC032E Modulo Pairing

可以用调整法证明：存在一个分界点，前面是 $x+y<M$ 的匹配，后面是 $x+y\ge M$ 的匹配，且两边的匹配一定是第一个匹配最后一个，第二个匹配倒数第二个，以此类推。二分这个分界点即可。

##### AGC032F One Third

把所有点写成 $k\times \frac{1}{3}+\omega$ 的形式，并且把 $k$ 相同的称为同色的，这样问题变为 $[0,\frac{1}{3})$ 内有 $n$ 个点，求期望最近异色点对距离。

有结论为长度为 $1$ 的线段切成 $n$ 段，第 $k$ 短的线段期望长度是 $\frac{1}{n^2}+\frac{1}{n(n-1)}+\cdots +\frac{1}{n(n-k+1)}$，因此枚举第 $i$ 长的段是最长不同色段，答案还要乘上前 $i-1$ 段都不同色的概率 $3^{i-1}$。

##### AGC033D Complexity

显然答案 $\log$ 级别，记 $f(t,k,l,r)$ 表示答案是 $t$ 时第 $k$ 行第 $l$ 至 $r$ 列至多延伸到第几行，列同理，转移 $O(1)$。

##### AGC033E Go around a Circle

假设开头是 R，那弧上必不能有 B 相邻。若串全是 R 就没有别的限制。若串有 B，那么弧上不能有偶数长度的 R，不然会被开头的奇偶性卡死，且长度不能超过这个长度 $+1$。而如果串后面存在两个 B 中间有奇数个 R，那么弧上连续的 R 长度也不能超过这个长度，不然跑不过去。有这三个条件 dp 即可。

##### AGC033F Adding Edges

考虑如果最终 $G$ 中有三元环 $a,b,c$，且 $T$ 中存在路径 $a,b,c$ 是一条链，那么 $G$ 中可以不要 $(a,c)$ 这条边。删边以后最终答案 $(x,y)$ 存在当且仅当存在 $T$ 中的路径 $x,a_1,a_2,\ldots,a_k,y$，且这个序列相邻两个在新 $G$ 中有边。

考虑怎么维护新 $G$，一条一条加边，如果某个时刻存在 $(a,b)(a,c)$ 且树上路径是 $a,b,c$，就把 $(a,c)$ 删掉换成 $(b,c)$。记 $top(a,b)=c$ 表示以 $a$ 为根时，存在边 $(a,c)$ 且 $c$ 是 $b$ 的祖先。加入 $(a,b)$ 时如果存在 $top(a,b)$ 就改为加入 $(top(a,b),b)$，否则可以加入 $(a,b)$，然后看看 $b$ 子树里是否存在 $(a,c)$ 需要被代替。最后 dfs 算下答案。

##### AGC034D Manhattan Max Matching

绝对值化开有四种结果，建四个虚点表示 $(\pm x,\pm y)$ 这四种符号然后跑费用流即可。

##### AGC034E Complete Compress

枚举集合点，那么合法时一定有方案使所有点都是向上移的。剩余部分和“榕树之心”类似，每个点都让深度和最大的去跟其他儿子消，如果太大了则有可能消不完，递归到儿子里去消即可。

##### AGC034F RNG and XOR

问题反过来就是一个数变成 $0$ 的次数，因此有 $E_0=0$，$E_x=\sum_{y}E_{x\oplus y}p_y+1$。那么 $E$ 和 $p$ 的异或卷积 $E\oplus P$ 就是 $E-I+2^n$，其中 $E_0$ 处多一个 $2^n$ 是因为 $P$ 和为 $1$ 因此 $E$ 卷积后和不变。即 $E\oplus(P-1)=-I+2^n$，可以求解出一个伪解 $E'$。求出的 $E_0$ 可能不为 $0$，注意到 $tI\oplus(P-1)=0$，因此 $E'-E'_0I$ 即为答案。

##### AGC035C Skolem XOR Tree

显然 $N$ 是 $2$ 的次幂 $N$ 就配对不上了。否则先连 $(1,2,3,1,2,3)$，然后连 $(1,2x,2x+1)$ 和 $(1,2x+1,2x)$ 就能把 $2x$ 和 $2x+1$ 配对上了。$N$ 是偶数就在 $1$ 的邻接点上找两个去连 $N$ 就行了。

##### AGC035D Add and Remove

考虑逆推，设 $f(l,r,x_l,x_r)$ 表示区间 $(l,r)$ 缩完且左右端点贡献分别是 $x_l$ 和 $x_r$ 倍的答案，中间转移的贡献就是 $x_l+x_r$ 倍。可以发现状态数是 $Cat_{16}$ 的，因此直接爆搜。

##### AGC035E Develop

考虑被删的数，如果 $x$ 向 $x-2$ 和 $x+k$ 连边，那么被删集合合法当且仅当无环。$k$ 是偶数奇偶独立，随便 dp 一下。$k$ 是奇数的时候显然有环一定是选了形如奇数区间 $[l,r]$ 和偶数区间 $[r-k,l+k]$。把偶数区间 shift 一下就是奇数区间 $[l,r]$ 和偶数区间 $[r,l+2k]$，即偶数的 $l+2k$ 不能存在一条到奇数 $l$ 的全选的链，也 dp 一下就行了。

##### AGC035F Two Histograms

考虑如果存在 $k_i+1=j,l_j=i$，即一个反 L 形，那么可以让 $k_i+1$，$l_j-1$。显然这样规范化后的序列唯一对于可能的局面。因此直接容斥，枚举有多少对反 L 形即可。

##### ARC089F ColoringBalls

考虑把最终结果划成有色的段，并把连续的 R 和 B 缩一起。对于有 $t-1$ 个 B 的段，称它属于第 $t$ 组，则第 $t$ 组的长度至少是 $2t-3$（$t=1$ 例外）。考虑一个 $t\ge 2$ 的组，它的染色方法必须 `rb` 开头，且长度为至少为 $t$。

考虑对 $N$ 整数划分来枚举每一段是第几组，这至多只有 $418662$ 种情况。一种枚举下显然可以贪心分配判断是否合法，如果合法，考虑贡献，首先有一个段与段之间的阶乘除阶乘，然后隔板法分组，考虑可以为空的只能是 $t\ge 2$ 的组的两边的 R，或者最开始和最结尾的 W。贡献是 $N+1+\sum_{v\ge 2}2$ 里选 $\sum 2v$。

##### ARC092F Two Faced Edges

对于边 $(a,b)$，如果 $b$ 能到 $a$ 那么 SCC 个数不变当且仅当删去 $(a,b)$ 后 $a$ 能到 $b$，如果 $b$ 不能到 $a$ 则相反。$b$ 能不能到 $a$ 显然易求，而求删去 $(a,b)$ 后 $a$ 能不能到 $b$ 可以分别考虑 $a$ 的出边中走这条边之前的边和之后的边能不能到 $b$，因此正反各扫一遍出边 dfs 即可。

##### ARC103D Robot Arms

首先 $x+y$ 奇偶性需相同。观察发现当两点曼哈顿距离 $\le 2k$ 时，加入一条长为 $k$ 的线段一定可以使这两点的曼哈顿距离 $\le k$。因此构造 $D$ 是 $2^{30},\ldots,4,2,1$ 即可让目标点与当前点的曼哈顿距离不断折半直到相遇。注意若 $x+y$ 是偶数则还需补一个 $1$。

##### ARC103F Distance Sums

按 $D$ 从小到大排序，倒着处理，确定 $v$ 的父亲。假设当前 $v$ 的子树大小是 $size$，那么显然它的父亲的 $D$ 应当是 $D_v+2size-n$，且因为 $D$ 互不相同，它父亲的 $D$ 一定比它小，不然不合法。依次确定即可。注意最后判 $D_1$ 是否正确。

##### CF559E Gerald and Path

设 $f(k)$ 表示 $k$ 左侧的点交 $(-\infty,k]$ 内的最大答案，dp 时枚举剩下区间的最右端点是谁贡献的，则区间内的其它灯都会朝左，一直向左扩展。预处理每个点能到的最左端点即可做到 $O(n^2)$。

##### CF585E Present for Vitalik the Philatelist 

用 $\mu$ 容斥求出 $\gcd=1$ 的子集个数，然后枚举 $x$，从所有 $\gcd > 1$ 的子集中减去与 $x$ 不互质的子集个数，也用 $\mu$ 容斥。