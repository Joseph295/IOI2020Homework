##### AGC020D Min Max Repetition

最终串一点是前半部分 $k$ 个 `A` 一个 `B` 循环，后半部分一个 `A` $k$ 个 `B` 循环，二分求出这个分界线。

##### AGC020E Encoding Subsets

记 $f(S)$ 表示状态 $S$ 的答案，直接记搜。可证状态数很少，是 $O(N^3+2^{N/8})$ 的，因此能过。

##### AGC020F Arcs on a Circle

考虑每个线段放置的位置的小数部分，只有小数部分的相对顺序会影响答案，因此如果把每个长度为 $1$ 的线段拆成 $n$ 份来表示相对位置，每种位置只会被占一次。同时状压每种线段和每种位置即可。

##### AGC021E Ball Eat Chameleons

枚举 $R$ 和 $B$，首先 $R<B$ 无解，$R\ge B$ 时还需满足能从序列中找出 $N-(R-B)$ 个子序列 `RB`。如果画到平面上，就相当于不经过斜线 $y-x\ge R-N+1$ 的路径计数，这是卡特兰数经典题。需要注意特判 $R=B$ 时必须以 `B` 结尾。

##### AGC021F Trinity

先不考虑空行，假设 $f(i,j)$ 表示行都非空的 $i$ 行 $j$ 列方案数，那么总答案是 $\sum \binom{n}{i} f(i,m)$。

考虑按列 dp，新增一列时枚举有 $k$ 行被新增了，即 $f(i,j) \to f(i+k,j+1)$，当 $k=0$ 时系数显然是 $\binom{i}{0}+\binom{i}{1}+\binom{i}{2}$，否则列最值一定在新增行的上下方。可以把列最值也看成空行，那么系数就是 $\binom{i+k+2}{k+2}$。转移形式是卷积，FFT 优化即可。

##### AGC022D Shopping

首先所有 $t \bmod 2L$，考虑朴素做法，就是从左到右每到一个点就额外花 $2L$ 的时间让车跑一圈。考虑两个点 $A<B$ 满足 $A$ 左边的路程 $\ge t_A$，$B$ 右边的路程 $\ge t_B$，那么先处理 $B$ 再处理 $A$ 就可以减少 $2L$ 的时间。因此求出最多的这种配对数即可。注意特判最后一个点是否需要跑一圈。

##### AGC022E Median Replace

在最后放一个 $1$，然后设序列 $a$ 是每两个 $1$ 之间的 $0$ 个数。可以发现操作在 $a$ 上相当于一个 $>2$ 的数 $-2$，或者将相邻两个 $x,y$ 合并成 $x+y-1$，或者将相邻两个 $0$ 消掉。因此奇数可以不管，剩下的偶数要找出两个 $0$ 使得前后的数的个数都是偶数个。于是就可以 dp 了。

##### AGC022F Checkers

$X$ 很大，不管它，把数都看成 $n$ 维向量。其次，向量里的顺序不影响，这里考虑向量里的数构成的多重集。即一开始所有都是 $\{1\}$，每次操作选 $A$ 和 $B$，合并为 $2A\cup -B$。

观察发现，合法集合里有 $\pm 2^k$ 就有 $\pm 2^{k-1}$，且总和一定为 $1$。此外，还有一个条件，即对于每个 $i$ 可以调整 $\pm 2^i$ 的符号来使得 $\le i$ 次项和为 $1$。证明必要性显然，考虑用归纳法证充分性，即合法集合 $S$ 定能拆成合法集合 $2A$ 和 $-B$。显然 $A$ 和 $B$ 其中一个符合这个条件时另一个一定符合。

不妨设 $-1\in S$，记 $S$ 的最小正值为 $+2^k$，假如更小的负次项都至少出现两次，那么构造 $A=\{-1,-2,\ldots,-2^{k-2},+2^{k-1}\}$ 合法。假如 $-2^1$ 只出现一次，取 $B=\{1\}$ 合法。否则 $S$ 本身就不合法。

最后考虑怎么 dp，设 $f(i,j)$ 表示 $i$ 个数，当前和是 $1+j\times 2^m$ 的形式的答案，其中 $2^m$ 是当前最高次项。dp 下一次项时并不需要知道 $m$ 具体是多少，只用枚举下一次项的正负个数即可。

##### AGC023D Go Home

考虑两端点的人数分别是 $A,B$，当 $A\ge B$ 因为 $B$ 打不过 $A$ 所以不能在 $A$ 之前到家，所以 $B$ 在 $A$ 到家之前会希望 $A$ 赶紧到家，因此可以看作 $A$ 处理。$A<B$ 同理。递归直到 $S$ 只有一侧有人即可。

##### AGC023E Inversions

考虑 $A_i\le A_j$ 位置处的贡献，显然是把 $A_j$ 修改为 $A_i$ 后的可能排列数除 $2$。考虑如何统计排列数，设 $c_i$ 是 $\ge i$ 的 $A$ 的个数减 $(N-i)$，那么答案是 $\prod c_i$。如果把 $A_j$ 改为 $A_i$ 相当于 $A_i+1\sim A_j$ 这段的 $c$ 减 $1$。设 $d$ 是 $\frac{c_i-1}{c_i}$ 的前缀积，那么新答案就是原答案乘 $\frac{d[A_j]}{d[A_i]}$。问题变为求 $j$ 前面小于 $A_j$ 的 $\frac{1}{d[A_i]}$ 的和，可以 BIT。注意 $d$ 是 $0$ 的情况，记一下 $0$ 个数就行。

对于 $A_i>A_j$ 的位置类似的求正序对然后用总的减就行了。

##### AGC023F 01 on Tree

给每个节点设置一个权值 $R_i$ 是节点上 $0$ 的个数除以 $1$ 的个数，因此当前树上 $R$ 最大的点一定在其父节点之后，将其与父节点合并然后继续下一轮。

##### AGC027E ABBreviate

设 `a` 为 $1$，`b` 为 $2$，那么 $S$ 可以变成字符 $c$ 当且仅当 $S=c$，或者 $\mathrm{Sum}(S) \mod3 =c$ 且 $S$ 有至少两个相邻字符相同。考虑 $S$ 变成 $T$ 的过程相当于对 $S$ 做一个划分，因此 dp 即可。

##### AGC032C Three Circuits

首先图是个欧拉图，有度数 $\ge 6$ 的点有解，有三个度数 $=4$ 的点有解，有两个度数 $=4$ 的点时，只有这两个点各有一自环才有解。

##### AGC032D Rotation Sort

操作相当于把数扔到往左往右任意一个位置，因此选出不动的数以后剩下的数的方向是固定的，从小到大 dp 不动的数即可。

##### AGC032E Modulo Pairing

可以用调整法证明：存在一个分界点，前面是 $x+y<M$ 的匹配，后面是 $x+y\ge M$ 的匹配，且两边的匹配一定是第一个匹配最后一个，第二个匹配倒数第二个，以此类推。二分这个分界点即可。

##### AGC032F One Third

把所有点写成 $k\times \frac{1}{3}+\omega$ 的形式，并且把 $k$ 相同的称为同色的，这样问题变为 $[0,\frac{1}{3})$ 内有 $n$ 个点，求期望最近异色点对距离。

有结论为长度为 $1$ 的线段切成 $n$ 段，第 $k$ 短的线段期望长度是 $\frac{1}{n^2}+\frac{1}{n(n-1)}+\cdots +\frac{1}{n(n-k+1)}$，因此枚举第 $i$ 长的段是最长不同色段，答案还要乘上前 $i-1$ 段都不同色的概率 $3^{i-1}$。

##### CF585E Present for Vitalik the Philatelist 

用 $\mu$ 容斥求出 $\gcd=1$ 的子集个数，然后枚举 $x$，从所有 $\gcd > 1$ 的子集中减去与 $x$ 不互质的子集个数，也用 $\mu$ 容斥。